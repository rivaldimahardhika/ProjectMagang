{% extends "base.html" %}
{% block title %}CCTV GCS{% endblock %}
{% block content %}
<style>
  html, body {
    margin: 0; padding: 0; overflow-x: hidden;
  }
  .wrapper {
    position: relative;
    width: 100%;
    background: url("{{ url_for('static', filename='img/background.png') }}") no-repeat top center;
    background-size: 100% auto;
  }
  .btn { position: absolute; cursor: pointer; transform: translate(-50%, -50%); }
  .btn-cctv { top: 7%; left: 44%; width: 5.5%; }
  .btn-deteksi { top: 6.9%; left: 54%; width: 7%; }
  .btn-dashboard { top: 7%; left: 66.5%; width: 10%; }
  .btn-tentang { top: 7.2%; left: 81.5%; width: 12.5%; }
  .btn-profile { top: 7.1%; left: 95%; width: 5.5%; }
  .btn-login { top: 64%; left: 17%; width: 11%; }

  /* logo */
  .logo-gcs {
    position: absolute;
    top: 0.05%;
    left: 1.45%;
    width: 10%;
    cursor: pointer;
  }

  /* Popup Profile */
  .profile-popup {
    position: absolute;
    width: 220px;
    background: #5b863f;
    border-radius: 20px;
    padding: 15px;
    display: none;
    box-shadow: 0px 4px 10px rgba(0,0,0,0.3);
    z-index: 9999;
  }
  .profile-popup h3 {
    margin: 0;
    font-size: 16px;  
    font-weight: normal;
    color: #FFCE5E;
    text-align: center;
    font-family: 'Poppins', sans-serif;
  }

  /* Tombol Logout (pakai <a>) */
  .logout-btn {
    display: block;
    text-align: center;
    text-decoration: none;
    margin-top: 12px;
    width: 100%;
    padding: 8px 0;
    background: #faa003;
    color: #fff;
    border-radius: 8px;
    font-size: 14px;
    cursor: pointer;
    font-family: 'Poppins', sans-serif;
  }
  .logout-btn:hover {
    background: #fa003f;
  }
</style>

<div class="wrapper" id="wrapper">
  <!-- LOGO -->
  <a href="{{ url_for('home') }}">
    <img src="{{ url_for('static', filename='img/logo_gcs.png') }}" class="logo-gcs" alt="Logo GCS">
  </a>

  <!-- Tombol navigasi -->
  <a href="{{ url_for('monitor') }}"><img src="{{ url_for('static', filename='img/CCTV.png') }}" class="btn btn-cctv"></a>
  <a href="{{ url_for('detect') }}"><img src="{{ url_for('static', filename='img/deteksi.png') }}" class="btn btn-deteksi"></a>
  <a href="{{ url_for('dashboard') }}"><img src="{{ url_for('static', filename='img/dashboard.png') }}" class="btn btn-dashboard"></a>
  <a href="{{ url_for('about') }}"><img src="{{ url_for('static', filename='img/tentang-kami.png') }}" class="btn btn-tentang"></a>

  {% if user %}
    <!-- Profile button -->
    <img src="{{ url_for('static', filename='img/profile.png') }}" class="btn btn-profile" id="profileBtn">
    
    <!-- Popup Profile -->
    <div class="profile-popup" id="profilePopup">
      <h3>{{ user.username }}</h3>
      <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
    </div>
  {% else %}
    <a href="{{ url_for('login') }}"><img src="{{ url_for('static', filename='img/login.png') }}" class="btn btn-login"></a>
  {% endif %}
</div>

<!-- Helper tinggi -->
<img id="bg-helper" src="{{ url_for('static', filename='img/background.png') }}" style="display:none;">

<script>
  const helper = document.getElementById("bg-helper");
  const wrapper = document.getElementById("wrapper");
  function setWrapperHeight() {
    const aspect = helper.naturalHeight / helper.naturalWidth;
    wrapper.style.height = wrapper.offsetWidth * aspect + "px";
    document.body.style.height = wrapper.style.height;
  }
  helper.onload = setWrapperHeight;
  window.addEventListener("resize", setWrapperHeight);

  // Popup Profile
  const profileBtn = document.getElementById("profileBtn");
  const profilePopup = document.getElementById("profilePopup");

  function positionPopup() {
    if (!profileBtn || !profilePopup) return;
    const rect = profileBtn.getBoundingClientRect();
    const wrapperRect = wrapper.getBoundingClientRect();
    profilePopup.style.top = (rect.bottom - wrapperRect.top + 10) + "px";
    profilePopup.style.left = (rect.right - wrapperRect.left - profilePopup.offsetWidth) + "px";
  }

  if (profileBtn) {
    profileBtn.addEventListener("click", () => {
      if (profilePopup.style.display === "block") {
        profilePopup.style.display = "none";
      } else {
        profilePopup.style.display = "block";
        positionPopup();
      }
    });
    document.addEventListener("click", (e) => {
      if (!profilePopup.contains(e.target) && e.target !== profileBtn) {
        profilePopup.style.display = "none";
      }
    });
    window.addEventListener("resize", () => {
      if (profilePopup.style.display === "block") positionPopup();
    });
    window.addEventListener("scroll", () => {
      if (profilePopup.style.display === "block") positionPopup();
    });
  }
</script>
{% endblock %}
